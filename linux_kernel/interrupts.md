## 中断和中断处理
硬件的处理速度比CPU慢很多，所以CPU不能一直等待硬件的回应，而应该硬件没有回应期间处理其他事务，等到硬件完成了请求的操作之后，在回过头来对它进行处理。

轮询的话效率会太低，更好的办法是让硬件在需要的时候再想内核发出信号。

### 7.1 中断
- 中断本质上是一种电信号，由硬件发送给处理器，处理器收到后马上向操作系统反映，然后由操作系统负责处理新到的数据。
- 中断的发生与时钟同步无关，随时都可以发生。内核随时可能因为新到来的中断而被打断。
- 中断值称为中断请求（IRQ）线。
- 异常：
  - 异常在产生时必须考虑时钟同步，也称为同步中断。
  - 产生原因是代码错误指令、或者缺页，因此必须由内核来处理。
  - 处理异常的方式和处理中断类似。

### 7.2 中断处理程序
- 响应中断时候执行的程序。
- 一个设备的中断处理程序是它设备驱动程序的一部分——设备驱动程序是用于对设备进行管理的内核代码。
- 按照特定类型声明的C函数。
- 运行在中断上下文中，也称为**原子上下文**，因为这个上下文的执行代码不可阻塞。
- 最起码的一点是要告知硬件：设备中断已被接收，请继续工作。其次还有许多工作需要它去做。

### 7.3 上半部与下半部的对比
为了满足响应速度快，同时还要处理很多工作的需求，一般将中断处理程序分为两部分：
- 上半部（top half）：接受到一个中断，立即执行，但有严格的时限，比如应答或者复位硬件
- 下半部（bottom half）：剩下的工作。

网卡收到网络数据包时，中断通知内核数据包到了。
- 网卡说：有最新的数据了
- 内核应答：
  - 通知硬件，拷贝最新的数据到内存，然后读取更多数据包。
  - 需要快速拷贝，因此网卡上的缓存大小固定，并且比系统内存小很多。
  - 快速拷贝，否则缓存溢出——更多的入包智能被丢弃。
  - 数据包拷贝完成了之后，中断的任务算是完成了。
  - 将控制权还给系统中断前原先运行的程序。
  - 处理和操作数据包的其他工作随后在下半部进行。

### 7.4 注册中断处理程序
